#include <iostream>
using namespace std;

struct Node
{
    int data;
    int height = 1;          // a new node is added as a leaf
    Node *left = NULL;
    Node *right = NULL;

    Node(int val)
    {
        this->data = val;
    }
};

int getHeight(Node *root)
{
    return root == NULL ? 0 : root->height;
}

void leftRotate(Node *&root)
{
    Node *lc = root->left;

    root->left = lc->right;
    lc->right = root;

    root->height = max(getHeight(root->left), getHeight(root->right)) + 1;
    lc->height = max(getHeight(lc->left), root->height) + 1;

    root = lc;
}

void rightRotate(Node *&root)
{
    Node *rc = root->right;

    root->right = rc->left;
    rc->left = root;

    root->height = max(getHeight(root->left), getHeight(root->right)) + 1;
    rc->height = max(getHeight(rc->left), root->height) + 1;

    root = rc;
}

void insert(Node *&root, int x)
{
    if (root == NULL)
    {
        root = new Node(x);
        return;
    }

    if (root->data > x)
    {
        insert(root->left, x);
    }
    else
    {
        insert(root->right, x);
    }

    int lh = getHeight(root->left);
    int rh = getHeight(root->right);

    root->height = max(lh, rh) + 1;

    if (lh == rh + 2)
    {
        if (x < root->left->data)
        {
            leftRotate(root);
        }
        else
        {
            rightRotate(root->left);
            leftRotate(root);
        }
    }
    else if (lh + 2 == rh)
    {
        if (x > root->right->data)
        {
            rightRotate(root);
        }
        else
        {
            leftRotate(root->right);
            rightRotate(root);
        }
    }
}

void deleteNode(Node *&root, int x)
{
    if (root == NULL)
    {
        return;
    }

    if (root->data > x)
    {
        deleteNode(root->left, x);
    }
    else if (root->data < x)
    {
        deleteNode(root->right, x);
    }
    else
    {
        if (root->left == NULL)
        {
            Node *temp = root;
            root = root->right;
            free(temp);
        }
        else if (root->right ==  NULL)
        {
            Node *temp = root;
            root = root->left;
            free(temp);
        }
        else
        {
            Node *temp = root->right;
            while (temp->left != NULL)
            {
                temp = temp->left;
            }

            root->data = temp->data;
            deleteNode(root->right, temp->data);
        }
    }

    if (root == NULL)
    {
        return;
    }

    int lh = getHeight(root->left);
    int rh = getHeight(root->right);

    root->height = max(lh, rh) + 1;

    if (lh == rh + 2)
    {
        if (getHeight(root->left) >= getHeight(root->right))
        {
            leftRotate(root);
        }
        else
        {
            rightRotate(root->left);
            leftRotate(root);
        }
    }
    else if (lh + 2 == rh)
    {
        if (getHeight(root->left) <= getHeight(root->right))
        {
            rightRotate(root);
        }
        else
        {
            leftRotate(root->right);
            rightRotate(root);
        }
    }
}

void preOrder(Node *root)
{
    if (root != NULL)
    {
        cout << root->data << " ";
        preOrder(root->left);
        preOrder(root->right);
    }
}

int main()
{
    Node *root = NULL;

    insert(root, 10);
    insert(root, 20);
    insert(root, 30);
    insert(root, 40);
    insert(root, 50);
    insert(root, 60);
    insert(root, 70);
    insert(root, 80);
    insert(root, 90);
    insert(root, 100);
    insert(root, 25);

    preOrder(root);
}

// 40 20 10 30 25 80 60 50 70 90 100

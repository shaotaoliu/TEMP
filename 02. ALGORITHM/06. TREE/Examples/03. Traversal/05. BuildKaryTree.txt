#include <bits/stdc++.h>
using namespace std;

struct Node
{
    int data;
    vector<Node*> child;
};

Node* newNode(int data)
{
    Node* nNode = new Node;
    nNode->data = data;
    return nNode;
}

void postord(Node* root, int k)
{
    if (root == NULL)
    {
        return;
    }

    for (int i = 0; i < root->child.size(); i++)
    {
        postord(root->child[i], k);
    }

    cout << root->data << " ";
}

Node *BuildTree(int a[], int n, int k)
{
    if (n == 0)
    {
        return NULL;
    }

    Node *root = newNode(a[0]);

    if (n - 1 <= k)
    {
        for (int i = 1; i < n; ++i)
        {
            root->child.push_back(newNode(a[i]));
        }

        return root;
    }

    int totalTree = 1;            // the number of nodes of the full tree
    int nodesOfLevel = 1;         // the number of nodes on one level

    while (totalTree < n)
    {
        nodesOfLevel *= k;
        totalTree += nodesOfLevel;
    }

    // find the size of each subtree
    int subtrees[k];                           // the number of nodes in each subtree
    int diff = totalTree - n;                  // the number of nodes to make the tree full
    int numOfLeaf = nodesOfLevel / k;          // the number of leaf nodes of a full subtree
    int totalSubtree = (totalTree - 1) / k;    // the number of nodes of a full subtree

    for (int i = k-1; i >= 0; --i)
    {
        if (diff > 0)
        {
            subtrees[i] = totalSubtree - min(diff, numOfLeaf);
            diff -= numOfLeaf;
        }
        else
        {
            subtrees[i] = totalSubtree;        // the subtree is complete
        }
    }

    // build each subtree based on its size
    int len = 1;
    for (int i = 0; i < k; ++i)
    {
        Node *child = BuildTree(a + len, subtrees[i], k);
        if (child != NULL)
        {
            root->child.push_back(child);
        }

        len += subtrees[i];
    }

    return root;
}

int main()
{
    int k = 3, n = 10;
    int preorder[] = { 1, 2, 5, 6, 7, 3, 8, 9, 10, 4 };
    Node* root = BuildTree(preorder, n, k);

    postord(root, k);
    return 0;
}

/*

5 6 7 2 8 9 10 3 4 1

*/